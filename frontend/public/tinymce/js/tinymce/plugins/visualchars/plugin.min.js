/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.9.0 (TBD)
 */
!function(){"use strict";var e,t,o,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(t){return function(n){return typeof n===t}},u=function(n){return n=typeof(t=n),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===e;var t},i=r("boolean"),c=r("number"),a=function(n){return function(){return n}},s=function(n){return n},f=a(!(e="string")),l=a(!0),d=function(){return m},m={fold:function(n,t){return n()},isSome:f,isNone:l,getOr:s,getOrThunk:r=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(undefined),or:s,orThunk:r,map:d,each:function(){},bind:d,exists:f,forall:l,filter:function(){return m},toArray:function(){return[]},toString:a("none()")},g=function(e){var n=a(e),t=function(){return r},o=function(n){return n(e)},r={fold:function(n,t){return t(e)},isSome:l,isNone:f,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:t,orThunk:t,map:function(n){return g(n(e))},each:function(n){n(e)},bind:o,exists:o,forall:o,filter:function(n){return n(e)?r:m},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return r},v=function(n){return null===n||n===undefined?m:g(n)},h=function(n,t){for(var e=0,o=n.length;e<o;e++)t(n[e],e)},p=Object.keys,y=function(n,t){for(var e=p(n),o=0,r=e.length;o<r;o++){var u=e[o];t(n[u],u)}},b=("undefined"!=typeof window||Function("return this;")(),function(n){return n.dom.nodeValue}),w=(t=3,function(n){return n.dom.nodeType===t}),T=function(n,t,e){!function(n,t,e){if(!(u(e)||i(e)||c(e)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")}(n.dom,t,e)},k=function(n,t){n.dom.removeAttribute(t)},N=function(n,t){t=function(n,t){t=n.dom.getAttribute(t);return null===t?undefined:t}(n,t);return t===undefined||""===t?[]:t.split(" ")},A=function(n){return n.dom.classList!==undefined},O=function(n,t){return function(n,t,e){e=N(n,t).concat([e]);return T(n,t,e.join(" ")),!0}(n,"class",t)},C=function(n,t){return o=t,0<(n=function(n,t){for(var e=[],o=0,r=n.length;o<r;o++){var u=n[o];t(u,o)&&e.push(u)}return e}(N(e=n,t="class"),function(n){return n!==o})).length?T(e,t,n.join(" ")):k(e,t),!1;var e,o},S=function(n){0===(A(n)?n.dom.classList:N(n,"class")).length&&k(n,"class")},D=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:n}},E={fromHtml:function(n,t){t=(t||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return D(t.childNodes[0])},fromTag:function(n,t){n=(t||document).createElement(n);return D(n)},fromText:function(n,t){n=(t||document).createTextNode(n);return D(n)},fromDom:D,fromPoint:function(n,t,e){return v(n.dom.elementFromPoint(t,e)).map(D)}},L={"\xa0":"nbsp","\xad":"shy"},d=function(n,t){var e="";return y(n,function(n,t){e+=t}),new RegExp("["+e+"]",t?"g":"")},x=d(L),V=d(L,!0),B=(o="",y(L,function(n){o&&(o+=","),o+="span.mce-"+n}),o),P="mce-nbsp",j=function(n){return'<span data-mce-bogus="1" class="mce-'+L[n]+'">'+n+"</span>"},M=function(n){var t=b(n);return w(n)&&t!==undefined&&x.test(t)},H=function(n,t){var e=[],n=function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var u=n[r];o[r]=t(u,r)}return o}(n.dom.childNodes,E.fromDom);return h(n,function(n){e=(e=t(n)?e.concat([n]):e).concat(H(n,t))}),e},_=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},F=function(u,n){n=H(E.fromDom(n),M);h(n,function(n){var t=n.dom.parentNode;if(_(t))t=E.fromDom(t),o=P,A(t)?t.dom.classList.add(o):O(t,o);else{for(var e,o=u.dom.encode(b(n)).replace(V,j),r=u.dom.create("div",null,o);e=r.lastChild;)u.dom.insertAfter(e,n.dom);u.dom.remove(n.dom)}})},I=function(o,n){n=o.dom.select(B,n);h(n,function(n){var t,e;_(n)?(t=E.fromDom(n),e=P,A(t)?t.dom.classList.remove(e):C(t,e),S(t)):o.dom.remove(n,!0)})},U=function(n){var t=n.getBody(),e=n.selection.getBookmark(),o=(o=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t))!==undefined?o:t;I(n,o),F(n,o),n.selection.moveToBookmark(e)},K=function(n,t){var e;e=n,o=t.get(),e.fire("VisualChars",{state:o});var o=n.getBody();(!0===t.get()?F:I)(n,o)},R=function(n,t){n.addCommand("mceVisualChars",function(){!function(n,t){t.set(!t.get());var e=n.selection.getBookmark();K(n,t),n.selection.moveToBookmark(e)}(n,t)})},q=tinymce.util.Tools.resolve("tinymce.util.Delay"),z=function(e,o){return function(t){t.setActive(o.get());var n=function(n){return t.setActive(n.state)};return e.on("VisualChars",n),function(){return e.off("VisualChars",n)}}};n.add("visualchars",function(n){var t,e,o,r,u,i,c,a,s,f=(o=n.getParam("visualchars_default_state",!1),t=o,{get:function(){return t},set:function(n){t=n}});return R(n,f),o=f,(e=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:z(e,o)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:z(e,o)}),r=n,u=f,i=q.debounce(function(){U(r)},300),!1!==r.getParam("forced_root_block")&&r.on("keydown",function(n){!0===u.get()&&(13===n.keyCode?U(r):i())}),r.on("remove",i.stop),a=f,(c=n).on("init",function(){K(c,a)}),s=f,{isEnabled:function(){return s.get()}}})}();