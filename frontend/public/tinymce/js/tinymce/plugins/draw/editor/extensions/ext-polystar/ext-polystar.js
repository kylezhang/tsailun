/**
 * @file ext-polystar.js
 *
 *
 * @copyright 2010 CloudCanvas, Inc. All rights reserved
 * @copyright 2021 Optimistik SAS, Inc. All rights reserved
 * @license MIT
 *
 */
const t="polystar",loadExtensionTranslation=async function(e){let l;const s=e.configObj.pref("lang");try{l=await function __variableDynamicImportRuntime0__(t){switch(t){case"./locale/en.js":return Promise.resolve().then((function(){return o}));case"./locale/fr.js":return Promise.resolve().then((function(){return n}));case"./locale/zh-CN.js":return Promise.resolve().then((function(){return i}));default:return new Promise((function(e,o){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t)))}))}}("./locale/".concat(s,".js"))}catch(e){console.warn("Missing translation (".concat(s,") for ").concat(t," - using 'en'")),l=await Promise.resolve().then((function(){return o}))}e.i18next.addResourceBundle(s,t,l.default)};var e={name:t,async init(){const e=this,{svgCanvas:o}=e,{ChangeElementCommand:n}=o.history,addToHistory=t=>{o.undoMgr.addCommandToHistory(t)},{$id:i,$click:l}=o;let s,a,r;await loadExtensionTranslation(e);const showPanel=(t,e)=>{t?i("".concat(e,"_panel")).style.removeProperty("display"):i("".concat(e,"_panel")).style.display="none"},setAttr=(t,e)=>{o.changeSelectedAttribute(t,e),o.call("changed",s)},cot=t=>1/Math.tan(t),sec=t=>1/Math.cos(t);return{name:e.i18next.t("".concat(t,":name")),callback(){const e="".concat(t,":title"),a="".concat(t,":buttons.0.title"),r="".concat(t,":buttons.1.title"),u='\n            <se-flyingbutton id="tools_polygon" title="'.concat(e,'">\n              <se-button id="tool_star" title="').concat(a,'" src="star.svg">\n              </se-button>\n              <se-button id="tool_polygon" title="').concat(r,'" src="polygon.svg">\n              </se-button>\n            </se-flyingbutton>\n          ');o.insertChildAtIndex(i("tools_left"),u,10),l(i("tool_star"),(()=>{this.leftPanel.updateLeftPanel("tool_star")&&(o.setMode("star"),showPanel(!0,"star"),showPanel(!1,"polygon"))})),l(i("tool_polygon"),(()=>{this.leftPanel.updateLeftPanel("tool_polygon")&&(o.setMode("polygon"),showPanel(!0,"polygon"),showPanel(!1,"star"))}));const c="".concat(t,":contextTools.0.label"),d="".concat(t,":contextTools.0.title"),g="".concat(t,":contextTools.1.label"),p="".concat(t,":contextTools.1.title"),b="".concat(t,":contextTools.2.label"),h="".concat(t,":contextTools.2.title"),m="".concat(t,":contextTools.3.label"),f="".concat(t,":contextTools.3.title"),y=document.createElement("template");y.innerHTML='\n          <div id="star_panel">\n            <se-spin-input id="starNumPoints" label="'.concat(c,'" min=1 step=1 value=5 title="').concat(d,'">\n            </se-spin-input>\n            <se-spin-input id="RadiusMultiplier" label="').concat(g,'" min=1 step=2.5 value=3 title="').concat(p,'">\n            </se-spin-input>\n            <se-spin-input id="radialShift" min=0 step=1 value=0 label="').concat(b,'" title="').concat(h,'">\n            </se-spin-input>\n          </div>\n          <div id="polygon_panel">\n            <se-spin-input size="3" id="polySides" min=1 step=1 value=5 label="').concat(m,'" title="').concat(f,'">\n            </se-spin-input>\n          </div>\n        '),i("tools_top").appendChild(y.content.cloneNode(!0)),showPanel(!1,"star"),showPanel(!1,"polygon"),i("starNumPoints").addEventListener("change",(t=>{setAttr("point",t.target.value);const e=t.target.value;let o=s.length;for(;o--;){const t=s[o];if(t.hasAttribute("r")){const o=t.getAttribute("point"),i=t.getAttribute("points"),l=t.getAttribute("radialshift");let s=0,a=0;if(t.points){const r=t.points,u=r.numberOfItems;for(let t=0;t<u;++t){const e=r.getItem(t);s+=parseFloat(e.x),a+=parseFloat(e.y)}const c=s/u,d=a/u,g=Number(t.getAttribute("r")),p=g/t.getAttribute("starRadiusMultiplier");let b="";for(let t=0;e>=t;t++){let o=2*Math.PI*(t/e);o-=Math.PI/2;let n=g*Math.cos(o)+c,i=g*Math.sin(o)+d;b+=n+","+i+" ",isNaN(p)||(o=2*Math.PI*(t/e)+Math.PI/e,o-=Math.PI/2,o+=l,n=p*Math.cos(o)+c,i=p*Math.sin(o)+d,b+=n+","+i+" ")}t.setAttribute("points",b),addToHistory(new n(t,{point:o,points:i}))}}}})),i("RadiusMultiplier").addEventListener("change",(t=>{setAttr("starRadiusMultiplier",t.target.value)})),i("radialShift").addEventListener("change",(t=>{setAttr("radialshift",t.target.value)})),i("polySides").addEventListener("change",(t=>{setAttr("sides",t.target.value);const e=t.target.value;let o=s.length;for(;o--;){const t=s[o];if(t.hasAttribute("edge")){const o=t.getAttribute("sides"),i=t.getAttribute("points");let l=0,s=0;if(t.points){const a=t.points,r=a.numberOfItems;for(let t=0;t<r;++t){const e=a.getItem(t);l+=parseFloat(e.x),s+=parseFloat(e.y)}const u=l/r,c=s/r,d=t.getAttribute("edge")/2*cot(Math.PI/e)*sec(Math.PI/e);let g="";for(let t=0;e>=t;t++){const o=2*Math.PI*t/e;g+=d*Math.cos(o)+u+","+(d*Math.sin(o)+c)+" "}t.setAttribute("points",g),addToHistory(new n(t,{sides:o,points:i}))}}}}))},mouseDown(t){if("star"===o.getMode()){const e=o.getColor("fill"),n=o.getColor("stroke"),l=o.getStrokeWidth();return a=!0,r=o.addSVGElementsFromJson({element:"polygon",attr:{cx:t.start_x,cy:t.start_y,id:o.getNextId(),shape:"star",point:i("starNumPoints").value,r:0,radialshift:i("radialShift").value,r2:0,orient:"point",fill:e,stroke:n,"stroke-width":l}}),{started:!0}}if("polygon"===o.getMode()){const e=o.getColor("fill"),n=o.getColor("stroke"),l=o.getStrokeWidth();return a=!0,r=o.addSVGElementsFromJson({element:"polygon",attr:{cx:t.start_x,cy:t.start_y,id:o.getNextId(),shape:"regularPoly",sides:i("polySides").value,orient:"x",edge:0,fill:e,stroke:n,"stroke-width":l}}),{started:!0}}},mouseMove(t){if(a){if("star"===o.getMode()){const e=Number(r.getAttribute("cx")),o=Number(r.getAttribute("cy")),n=Number(r.getAttribute("point")),i=r.getAttribute("orient"),l=r.getAttribute("fill"),s=r.getAttribute("stroke"),a=Number(r.getAttribute("stroke-width")),u=Number(r.getAttribute("radialshift"));let c=t.mouse_x,d=t.mouse_y;const g=Math.sqrt((c-e)*(c-e)+(d-o)*(d-o))/1.5,p=document.getElementById("RadiusMultiplier").value,b=g/p;r.setAttribute("r",g),r.setAttribute("r2",b),r.setAttribute("starRadiusMultiplier",p);let h="";for(let t=0;n>=t;t++){let l=2*Math.PI*(t/n);"point"===i?l-=Math.PI/2:"edge"===i&&(l=l+Math.PI/n-Math.PI/2),c=g*Math.cos(l)+e,d=g*Math.sin(l)+o,h+=c+","+d+" ",isNaN(b)||(l=2*Math.PI*(t/n)+Math.PI/n,"point"===i?l-=Math.PI/2:"edge"===i&&(l=l+Math.PI/n-Math.PI/2),l+=u,c=b*Math.cos(l)+e,d=b*Math.sin(l)+o,h+=c+","+d+" ")}return r.setAttribute("points",h),r.setAttribute("fill",l),r.setAttribute("stroke",s),r.setAttribute("stroke-width",a),r.getAttribute("shape"),{started:!0}}if("polygon"===o.getMode()){const e=Number(r.getAttribute("cx")),o=Number(r.getAttribute("cy")),n=Number(r.getAttribute("sides")),i=r.getAttribute("fill"),l=r.getAttribute("stroke"),s=Number(r.getAttribute("stroke-width"));let a=t.mouse_x,u=t.mouse_y;const c=Math.sqrt((a-e)*(a-e)+(u-o)*(u-o))/1.5;r.setAttribute("edge",c);const d=c/2*cot(Math.PI/n)*sec(Math.PI/n);let g="";for(let t=0;n>=t;t++){const i=2*Math.PI*t/n;a=d*Math.cos(i)+e,u=d*Math.sin(i)+o,g+=a+","+u+" "}return r.setAttribute("points",g),r.setAttribute("fill",i),r.setAttribute("stroke",l),r.setAttribute("stroke-width",s),{started:!0}}}},mouseUp(){if("star"===o.getMode()){return{keep:"0"!==r.getAttribute("r"),element:r}}if("polygon"===o.getMode()){return{keep:"0"!==r.getAttribute("edge"),element:r}}},selectedChanged(t){s=t.elems;let e=s.length;for(;e--;){const o=s[e];"star"===(null==o?void 0:o.getAttribute("shape"))?t.selectedElement&&!t.multiselected?(i("starNumPoints").value=o.getAttribute("point"),i("radialShift").value=o.getAttribute("radialshift"),showPanel(!0,"star")):showPanel(!1,"star"):"regularPoly"===(null==o?void 0:o.getAttribute("shape"))?t.selectedElement&&!t.multiselected?(i("polySides").value=o.getAttribute("sides"),showPanel(!0,"polygon")):showPanel(!1,"polygon"):(showPanel(!1,"star"),showPanel(!1,"polygon"))}}}}},o=Object.freeze({__proto__:null,default:{name:"star",title:"Polygone/Star Tool",buttons:[{title:"Star Tool"},{title:"Polygon Tool"}],contextTools:[{title:"Number of Sides",label:"points"},{title:"Pointiness",label:"Pointiness"},{title:"Twists the star",label:"Radial Shift"},{title:"Number of Sides",label:"sides"}]}}),n=Object.freeze({__proto__:null,default:{name:"etoile",title:"Outil Polygone/Etoile",buttons:[{title:"Outil Etoile"},{title:"Outil Polygone"}],contextTools:[{title:"Nombre de côtés",label:"points"},{title:"Précision",label:"Précision"},{title:"Torsion Etoile",label:"Décalage Radial"},{title:"Nombre de côtés",label:"côtés"}]}}),i=Object.freeze({__proto__:null,default:{name:"星形",title:"Polygone/Star Tool",buttons:[{title:"星形工具"},{title:"多边形工具"}],contextTools:[{title:"顶点",label:"顶点"},{title:"钝度",label:"钝度"},{title:"径向",label:"径向"},{title:"边数",label:"边数"}]}});export{e as default};
//# sourceMappingURL=ext-polystar.js.map
