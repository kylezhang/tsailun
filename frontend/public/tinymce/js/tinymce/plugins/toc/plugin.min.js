/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.9.0 (TBD)
 */
!function(){"use strict";var n,e,t=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),d=tinymce.util.Tools.resolve("tinymce.util.I18n"),r=tinymce.util.Tools.resolve("tinymce.util.Tools"),i=function(t){return t.getParam("toc_class","mce-toc")},m=function(t){t=t.getParam("toc_header","h2");return/^h[1-6]$/.test(t)?t:"h2"},c=(n="mcetoc_",e=0,function(){var t=(new Date).getTime().toString(32);return n+t+(e++).toString(32)}),f=function(e){var o=i(e),t=m(e),n=function(t){for(var n=[],e=1;e<=t;e++)n.push("h"+e);return n.join(",")}(function(t){t=parseInt(t.getParam("toc_depth","3"),10);return 1<=t&&t<=9?t:3}(e)),n=e.$(n);return n.length&&/^h[1-9]$/i.test(t)&&(n=n.filter(function(t,n){return!e.dom.hasClass(n.parentNode,o)})),r.map(n,function(t){var n=t.id;return{id:n||c(),level:parseInt(t.nodeName.replace(/^H/i,""),10),title:e.$.text(t),element:t}})},o=function(t){var n,e,o,r="",i=f(t);if(!i.length)return"";r+=(e=m(t),o=d.translate("Table of Contents"),t="</"+e+">","<"+e+' contenteditable="true">'+u.DOM.encode(o)+t);for(var c=function(t){for(var n=9,e=0;e<t.length;e++)if(1===(n=t[e].level<n?t[e].level:n))return n;return n}(i),a=0;a<i.length;a++){(n=i[a]).element.id=n.id;for(var l="&nbsp;&nbsp;",s=c;s<n.level;s++)l+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";r+='<div class="tsltoc_item tsltoc_item_'+n.level+'"><span aria-hidden="true" class="tsltoc_indent tsltoc_indent_'+n.level+'">'+l+"</span><span>",r+='<a href="#'+n.id+'">'+n.title+"</a>",r+="</span></div>"}return r},a=function(t){var n=i(t),e=t.$("."+n);n=t,!(e=e).length||0<n.dom.getParents(e[0],".mce-offscreen-selection").length?t.insertContent((e=o(n=t),'<div class="'+n.dom.encode(i(n))+'" contenteditable="false">'+e+"</div>")):l(t)},l=function(t){var n=i(t),e=t.$("."+n);e.length&&t.undoManager.transact(function(){e.html(o(t))})},s=function(e){return function(t){var n=function(){return t.setDisabled(e.mode.isReadOnly()||!(0<f(e).length))};return n(),e.on("LoadContent SetContent change",n),function(){return e.on("LoadContent SetContent change",n)}}},p=function(t){var n;t.ui.registry.addButton("toc",{icon:"toc",tooltip:"Table of contents",onAction:function(){return t.execCommand("mceInsertToc")},onSetup:s(t)}),t.ui.registry.addButton("tocupdate",{icon:"reload",tooltip:"Update",onAction:function(){return t.execCommand("mceUpdateToc")}}),t.ui.registry.addMenuItem("toc",{icon:"toc",text:"Table of contents",onAction:function(){return t.execCommand("mceInsertToc")},onSetup:s(t)}),t.ui.registry.addContextToolbar("toc",{items:"tocupdate",predicate:(n=t,function(t){return t&&n.dom.is(t,"."+i(n))&&n.getBody().contains(t)}),scope:"node",position:"node"})};t.add("toc",function(t){var n,e,o;(n=t).addCommand("mceInsertToc",function(){a(n)}),n.addCommand("mceUpdateToc",function(){l(n)}),p(t),e=(t=t).$,o=i(t),t.on("PreProcess",function(t){t=e("."+o,t.node);t.length&&(t.removeAttr("contentEditable"),t.find("[contenteditable]").removeAttr("contentEditable"))}),t.on("SetContent",function(){var t=e("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})})}();