/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.9.0 (TBD)
 */
!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function i(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function o(t,n,r){if(r||2===arguments.length)for(var e,o=0,a=n.length;o<a;o++)!e&&o in n||((e=e||Array.prototype.slice.call(n,0,o))[o]=n[o]);return t.concat(e||n)}var n=function(r){return function(t){return t=typeof(n=t),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===r;var n}},u=n("string"),f=n("object"),c=n("array"),e=function(){},a=function(t){return function(){return t}},s=function(t){return t},l=a(!1),d=a(!0),r=function(){return m},m={fold:function(t,n){return t()},isSome:l,isNone:d,getOr:s,getOrThunk:n=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(undefined),or:s,orThunk:n,map:r,each:e,bind:r,exists:l,forall:d,filter:function(){return m},toArray:function(){return[]},toString:a("none()")},g=function(r){var t=a(r),n=function(){return o},e=function(t){return t(r)},o={fold:function(t,n){return n(r)},isSome:d,isNone:l,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return g(t(r))},each:function(t){t(r)},bind:e,exists:e,forall:e,filter:function(t){return t(r)?o:m},toArray:function(){return[r]},toString:function(){return"some("+r+")"}};return o},p={some:g,none:r,from:function(t){return null===t||t===undefined?m:g(t)}},h=Array.prototype.slice,v=Array.prototype.indexOf,y=function(t,n){return-1<v.call(t,n)},b=function(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e},k=function(t,n){for(var r=0,e=t.length;r<e;r++)n(t[r],r)},O=function(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r},w=function(t,n,r){return function(t,n){for(var r=t.length-1;0<=r;r--)n(t[r],r)}(t,function(t){r=n(r,t)}),r},C=function(t,n){return function(t,n,r){for(var e=0,o=t.length;e<o;e++){var a=t[e];if(n(a,e))return p.some(a);if(r(a,e))break}return p.none()}(t,n,l)},E=function(t,n){for(var r=0,e=t.length;r<e;++r)if(!0!==n(t[r],r))return!1;return!0},x=function(t){return n=t,(t=0)<=t&&t<n.length?p.some(n[t]):p.none();var n},R=Object.keys,T=Object.hasOwnProperty,P=(function(i){if(!c(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var u=[],r={};k(i,function(t,e){var n=R(t);if(1!==n.length)throw new Error("one and only one name per case");var o=n[0],a=t[o];if(r[o]!==undefined)throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!c(a))throw new Error("case arguments must be an array");u.push(o),r[o]=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var n=r.length;if(n!==a.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+a.length+" ("+a+"), got "+n);return{fold:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+t.length);return t[e].apply(null,r)},match:function(t){var n=R(t);if(u.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+n.join(","));if(!E(u,function(t){return y(n,t)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+u.join(", "));return t[o].apply(null,r)},log:function(t){console.log(t,{constructors:u,constructor:o,params:r})}}}})}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],r=[];return k(t,function(t){t.fold(function(t){n.push(t)},function(t){r.push(t)})}),{errors:n,values:r}}),N=function(r){return{is:function(t){return r===t},isValue:d,isError:l,getOr:a(r),getOrThunk:a(r),getOrDie:a(r),or:function(t){return N(r)},orThunk:function(t){return N(r)},fold:function(t,n){return n(r)},map:function(t){return N(t(r))},mapError:function(t){return N(r)},each:function(t){t(r)},bind:function(t){return t(r)},exists:function(t){return t(r)},forall:function(t){return t(r)},toOptional:function(){return p.some(r)}}},S=function(r){return{is:l,isValue:l,isError:d,getOr:s,getOrThunk:function(t){return t()},getOrDie:function(){return t=String(r),function(){throw new Error(t)}();var t},or:s,orThunk:function(t){return t()},fold:function(t,n){return t(r)},map:function(t){return S(r)},mapError:function(t){return S(t(r))},each:e,bind:function(t){return S(r)},exists:l,forall:d,toOptional:p.none}},M={value:N,error:S,fromOption:function(t,n){return t.fold(function(){return S(n)},N)}},B=function(t){return"inline-command"===t.type||"inline-format"===t.type},D=function(t){return"block-command"===t.type||"block-format"===t.type},I=function(t){return function(t,n){t=h.call(t,0);return t.sort(n),t}(t,function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1})},A=function(e){var o=function(t){return M.error({message:t,pattern:e})},t=function(t,n,r){if(e.format===undefined)return e.cmd!==undefined?u(e.cmd)?M.value(r(e.cmd,e.value)):o(t+" pattern has non-string `cmd` parameter"):o(t+" pattern is missing both `format` and `cmd` parameters");r=void 0;if(c(e.format)){if(!E(e.format,u))return o(t+" pattern has non-string items in the `format` array");r=e.format}else{if(!u(e.format))return o(t+" pattern has non-string `format` parameter");r=[e.format]}return M.value(n(r))};if(!f(e))return o("Raw pattern is not an object");if(!u(e.start))return o("Raw pattern is missing `start` parameter");if(e.end===undefined)return e.replacement!==undefined?u(e.replacement)?0===e.start.length?o("Replacement pattern has empty `start` parameter"):M.value({type:"inline-command",start:"",end:e.start,cmd:"mceInsertContent",value:e.replacement}):o("Replacement pattern has non-string `replacement` parameter"):0===e.start.length?o("Block pattern has empty `start` parameter"):t("Block",function(t){return{type:"block-format",start:e.start,format:t[0]}},function(t,n){return{type:"block-command",start:e.start,cmd:t,value:n}});if(!u(e.end))return o("Inline pattern has non-string `end` parameter");if(0===e.start.length&&0===e.end.length)return o("Inline pattern has empty `start` and `end` parameters");var r=e.start,a=e.end;return 0===a.length&&(a=r,r=""),t("Inline",function(t){return{type:"inline-format",start:r,end:a,format:t}},function(t,n){return{type:"inline-command",start:r,end:a,cmd:t,value:n}})},j=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},_=function(t){return{inlinePatterns:O(t,B),blockPatterns:I(O(t,D))}},U="undefined"!=typeof window?window:Function("return this;")(),L=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=U.console;r&&(r.error||r.log).apply(r,t)},V=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],W=function(t){t=t.getParam("forced_root_block","p");return!1===t?"":!0===t?"p":t},q=tinymce.util.Tools.resolve("tinymce.util.Delay"),F=tinymce.util.Tools.resolve("tinymce.util.VK"),G=tinymce.util.Tools.resolve("tinymce.util.Tools"),r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),H=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),J=function(t,n){return{container:t,offset:n}},K=function(t){return t.nodeType===Node.TEXT_NODE},X=function(t,n,r){var e;n&&t.isEmpty(n)&&!r(n)&&(e=n.parentNode,t.remove(n),X(t,e,r))},z=function(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&(K(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),K(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),X(t,o,r),o!==a&&X(t,a,r))},Q=function(t,n){t=n.get(t);return c(t)&&x(t).exists(function(t){return n="block",T.call(t,n);var n})},Y=function(t){return 0===t.start.length},Z=function(t,n){n=p.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===W(t)?n.orThunk(function(){return p.some(t.getBody())}):n},$=r.DOM,tt=function(n){return function(t){return n===t?-1:0}},nt=function(t,n,r){if(K(t)&&0<=n)return p.some(J(t,n));var e=H($);return p.from(e.backwards(t,n,tt(t),r)).map(function(t){return J(t.container,t.container.data.length)})},rt=function(t,r,e){if(!K(t))return p.none();var n=t.textContent;if(0<=r&&r<=n.length)return p.some(J(t,r));n=H($);return p.from(n.backwards(t,r,tt(t),e)).bind(function(t){var n=t.container.data;return rt(t.container,r+n.length,e)})},et=function(t,n,r){if(!K(t))return p.none();var e=t.textContent;if(n<=e.length)return p.some(J(t,n));var o=H($);return p.from(o.forwards(t,n,tt(t),r)).bind(function(t){return et(t.container,n-e.length,r)})},ot=function(t,n,r,e,o){var a,t=H(t,(a=t,function(t){return a.isBlock(t)||y(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===a.getContentEditable(t)}));return p.from(t.backwards(n,r,e,o))},at=function(t,n,r){if(K(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]},it=function(t,n,r,e,o){return{start:at(t,n,r),end:at(t,e,o)}},ut=function(t,n){var r,e,n=n.slice(),o=n.pop();return(n=n,r=function(t,n){return t.bind(function(t){return p.from(t.childNodes[n])})},e=p.some(t),k(n,function(t){e=r(e,t)}),e).bind(function(t){return K(t)&&(o<0||o>t.data.length)?p.none():p.some({node:t,offset:o})})},ft=function(n,r){return ut(n,r.start).bind(function(t){var e=t.node,o=t.offset;return ut(n,r.end).map(function(t){var n=t.node,r=t.offset,t=document.createRange();return t.setStart(e,o),t.setEnd(n,r),t})})},ct=function(e,o,n){(function(t,n,r){if(K(t)&&n>=t.length)return p.some(J(t,n));var e=H($);return p.from(e.forwards(t,n,tt(t),r)).map(function(t){return J(t.container,0)})})(o,0,o).each(function(t){var r=t.container;et(r,n.start.length,o).each(function(t){var n=e.createRng();n.setStart(r,0),n.setEnd(t.container,t.offset),z(e,n,function(t){return t===o})})})},st=function(r,a){var i=r.dom,t=r.selection.getRng();return Z(r,t).filter(function(t){var n=W(r),n=""===n&&i.is(t,"body")||i.is(t,n);return null!==t&&n}).bind(function(n){var t,r,e,o=n.textContent;return(t=a,e=(r=o).replace("\xa0"," "),C(t,function(t){return 0===r.indexOf(t.start)||0===e.indexOf(t.start)})).map(function(t){return G.trim(o).length===t.start.length?[]:[{pattern:t,range:it(i.getRoot(),n,0,n,0)}]})}).getOr([])},lt=function(o,t){var n;0!==t.length&&(n=o.selection.getBookmark(),k(t,function(t){return r=t,t=(n=o).dom,e=r.pattern,r=ft(t.getRoot(),r.range).getOrDie("Unable to resolve path range"),Z(n,r).each(function(t){"block-format"===e.type?Q(e.format,n.formatter)&&n.undoManager.transact(function(){ct(n.dom,t,e),n.formatter.apply(e.format)}):"block-command"===e.type&&n.undoManager.transact(function(){ct(n.dom,t,e),n.execCommand(e.cmd,!1,e.value)})}),!0;var n,r,e}),o.selection.moveToBookmark(n))},dt=0,mt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},gt=function(t,n){t=t.createRng();return t.setStartAfter(n.start),t.setEndBefore(n.end),t},pt=function(t,n,r){var e=ft(t.getRoot(),r).getOrDie("Unable to resolve path range"),o=e.startContainer,r=e.endContainer,r=0===e.endOffset?r:r.splitText(e.endOffset),e=0===e.startOffset?o:o.splitText(e.startOffset);return{prefix:n,end:r.parentNode.insertBefore(mt(t,n+"-end"),r),start:e.parentNode.insertBefore(mt(t,n+"-start"),e)}},ht=function(t,n,r){X(t,t.get(n.prefix+"-end"),r),X(t,t.get(n.prefix+"-start"),r)},vt=function(e,n,o,t){var r,a=n.start;return ot(e,t.container,t.offset,(r=a,function(t,n){t=t.data.substring(0,n),n=t.lastIndexOf(r.charAt(r.length-1)),t=t.lastIndexOf(r);return-1!==t?t+r.length:-1!==n?n+1:-1}),o).bind(function(r){if(r.offset>=a.length){var t=e.createRng();return t.setStart(r.container,r.offset-a.length),t.setEnd(r.container,r.offset),p.some(t)}t=r.offset-a.length;return rt(r.container,t,o).map(function(t){var n=e.createRng();return n.setStart(t.container,t.offset),n.setEnd(r.container,r.offset),n}).filter(function(t){return t.toString()===a}).orThunk(function(){return vt(e,n,o,J(r.container,0))})})},yt=function(o,a,i){var u=o.dom,f=u.getRoot(),c=i.pattern,s=i.position.container,l=i.position.offset;return rt(s,l-i.pattern.end.length,a).bind(function(t){var r=it(f,t.container,t.offset,s,l);if(Y(c))return p.some({matches:[{pattern:c,startRng:r,endRng:r}],position:t});var n=bt(o,i.remainingPatterns,t.container,t.offset,a),e=n.getOr({matches:[],position:t}),t=e.position;return function(t,r,n,e,o,a){if(void 0===a&&(a=!1),0!==r.start.length||a)return nt(n,e,o).bind(function(n){return vt(t,r,o,n).bind(function(t){if(a){if(t.endContainer===n.container&&t.endOffset===n.offset)return p.none();if(0===n.offset&&t.endContainer.textContent.length===t.endOffset)return p.none()}return p.some(t)})});var i=t.createRng();return i.setStart(n,e),i.setEnd(n,e),p.some(i)}(u,c,t.container,t.offset,a,n.isNone()).map(function(t){var n=it(f,t.startContainer,t.startOffset,t.endContainer,t.endOffset);return{matches:e.matches.concat([{pattern:c,startRng:n,endRng:r}]),position:J(t.startContainer,t.startOffset)}})})},bt=function(f,c,s,l,d){var m=f.dom;return nt(s,l,m.getRoot()).bind(function(t){var n=m.createRng();n.setStart(d,0),n.setEnd(s,l);for(var r,e,o=n.toString(),a=0;a<c.length;a++){var i=c[a];if(r=o,e=i.end,u=void 0,u=e,e=(r=r).length-e.length,""===u||r.length>=u.length&&r.substr(e,e+u.length)===u){var u=c.slice();u.splice(a,1);u=yt(f,d,{pattern:i,remainingPatterns:u,position:t});if(u.isSome())return u}}return p.none()})},kt=function(n,t,r){n.selection.setRng(r),"inline-format"===t.type?k(t.format,function(t){n.formatter.apply(t)}):n.execCommand(t.cmd,!1,t.value)},Ot=function(e,t){var n,r,o=(n="mce_textpattern",r=(new Date).getTime(),n+"_"+Math.floor(1e9*Math.random())+ ++dt+String(r)),a=w(t,function(t,n){var r=pt(e,o+"_end"+t.length,n.endRng);return t.concat([i(i({},n),{endMarker:r})])},[]);return w(a,function(t,n){var r=a.length-t.length-1,r=Y(n.pattern)?n.endMarker:pt(e,o+"_start"+r,n.startRng);return t.concat([i(i({},n),{startMarker:r})])},[])},wt=function(r,e,o){var a=r.selection.getRng();return!1===a.collapsed?[]:Z(r,a).bind(function(t){var n=a.startOffset-(o?1:0);return bt(r,e,a.startContainer,n,t)}).fold(function(){return[]},function(t){return t.matches})},Ct=function(e,t){var o,n;0!==t.length&&(o=e.dom,n=e.selection.getBookmark(),t=Ot(o,t),k(t,function(t){var n=o.getParent(t.startMarker.start,o.isBlock),r=function(t){return t===n};Y(t.pattern)?function(t,n,r,e){r=gt(t.dom,r);z(t.dom,r,e),kt(t,n,r)}(e,t.pattern,t.endMarker,r):function(t,n,r,e,o){var a=t.dom,i=gt(a,e),u=gt(a,r);z(a,u,o),z(a,i,o);e={prefix:r.prefix,start:r.end,end:e.start},e=gt(a,e);kt(t,n,e)}(e,t.pattern,t.startMarker,t.endMarker,r),ht(o,t.endMarker,r),ht(o,t.startMarker,r)}),e.selection.moveToBookmark(n))},Et=function(t,n){var r=wt(t,n.inlinePatterns,!0);0<r.length&&t.undoManager.transact(function(){Ct(t,r)})},xt=function(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return!0},Rt=function(n,r){var e=[",",".",";",":","!","?"],o=[32];n.on("keydown",function(t){13!==t.keyCode||F.modifierPressed(t)||!function(r,t){if(!r.selection.isCollapsed())return!1;var n=wt(r,t.inlinePatterns,!1),e=st(r,t.blockPatterns);return(0<e.length||0<n.length)&&(r.undoManager.add(),r.undoManager.extra(function(){r.execCommand("mceInsertNewLine")},function(){r.insertContent("\ufeff"),Ct(r,n),lt(r,e);var t=r.selection.getRng(),t=nt(t.startContainer,t.startOffset,r.dom.getRoot());r.execCommand("mceInsertNewLine"),t.each(function(t){var n=t.container;"\ufeff"===n.data.charAt(t.offset-1)&&(n.deleteData(t.offset-1,1),X(r.dom,n.parentNode,function(t){return t===r.dom.getRoot()}))})}),!0)}(n,r.get())||t.preventDefault()},!0),n.on("keyup",function(t){xt(o,t,function(t,n){return t===n.keyCode&&!1===F.modifierPressed(n)})&&Et(n,r.get())}),n.on("keypress",function(t){xt(e,t,function(t,n){return t.charCodeAt(0)===n.charCode})&&q.setEditorTimeout(n,function(){Et(n,r.get())})})};t.add("textpattern",function(t){var n,r,e,n=(n=function(t){t=t.getParam("textpattern_patterns",V,"array");if(!c(t))return L("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};t=P(b(t,A));return k(t.errors,function(t){return L(t.message,t.pattern),0}),_(t.values)}(t),r=n,{get:function(){return r},set:function(t){r=t}});return Rt(t,n),e=n,{setPatterns:function(t){var n=P(b(t,A));if(0<n.errors.length){t=n.errors[0];throw new Error(t.message+":\n"+JSON.stringify(t.pattern,null,2))}e.set(_(n.values))},getPatterns:function(){return o(o([],b(e.get().inlinePatterns,j)),b(e.get().blockPatterns,j))}}})}();