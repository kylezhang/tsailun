/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.9.0 (TBD)
 */
!function(){"use strict";var t,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=0,r=function(e,t,n){var r,o,i=e.editorUpload.blobCache,t=i.create((r="mceu",o=(new Date).getTime(),r+"_"+Math.floor(1e9*Math.random())+ ++u+String(o)),n,t);i.add(t),e.insertContent(e.dom.createHTML("img",{src:t.blobUri()}))},o=tinymce.util.Tools.resolve("tinymce.util.Promise"),c=tinymce.util.Tools.resolve("tinymce.Env"),a=tinymce.util.Tools.resolve("tinymce.util.Delay"),n=function(u){u.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:function(){var i;i=u,new o(function(n){var r=document.createElement("input");r.type="file",r.accept="image/*",r.style.position="fixed",r.style.left="0",r.style.top="0",r.style.opacity="0.001",document.body.appendChild(r);r.addEventListener("change",function(e){n(Array.prototype.slice.call(e.target.files))});var o=function(e){var t=function(){n([]),r.parentNode.removeChild(r)};c.os.isAndroid()&&"remove"!==e.type?a.setEditorTimeout(i,t,0):t(),i.off("focusin remove",o)};i.on("focusin remove",o),r.click()}).then(function(e){var t,n;0<e.length&&(t=e[0],n=t,new o(function(e){var t=new FileReader;t.onloadend=function(){e(t.result.split(",")[1])},t.readAsDataURL(n)}).then(function(e){r(u,e,t)}))})}}),u.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:function(){var e,t,n,r,o,i;n=t=2,(e=u).plugins.table?e.plugins.table.insertTable(t,n):(o=t,i=n,(r=e).undoManager.transact(function(){r.insertContent(function(e,t){var n,r,o='<table data-mce-id="mce" style="width: 100%">';for(o+="<tbody>",r=0;r<t;r++){for(o+="<tr>",n=0;n<e;n++)o+="<td><br></td>";o+="</tr>"}return o+="</tbody>",o+="</table>"}(o,i));var e=r.dom.select("*[data-mce-id]")[0];e.removeAttribute("data-mce-id");e=r.dom.select("td,th",e);r.selection.setCursorLocation(e[0],0)}))}})},i=function(n){return function(e){return e=typeof(t=e),(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)===n;var t}},l=function(t){return function(e){return typeof e===t}},d=i("string"),f=i("object"),s=i("array"),m=l("boolean"),g=(t=undefined,function(e){return t===e}),h=l("function"),p=function(e){return function(){return e}},b=function(e){return e},y=p(!1),v=p(!0),i=function(){return k},k={fold:function(e,t){return e()},isSome:y,isNone:v,getOr:b,getOrThunk:l=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:p(null),getOrUndefined:p(undefined),or:b,orThunk:l,map:i,each:function(){},bind:i,exists:y,forall:v,filter:function(){return k},toArray:function(){return[]},toString:p("none()")},w=function(n){var e=p(n),t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},isSome:v,isNone:y,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return w(e(n))},each:function(e){e(n)},bind:r,exists:r,forall:r,filter:function(e){return e(n)?o:k},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},T={some:w,none:i,from:function(e){return null===e||e===undefined?k:w(e)}};function E(e,t,n,r,o){return e(n,r)?T.some(n):h(o)&&o(n)?T.none():t(n,r,o)}var N,M=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:e}},S={fromHtml:function(e,t){t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return M(t.childNodes[0])},fromTag:function(e,t){e=(t||document).createElement(e);return M(e)},fromText:function(e,t){e=(t||document).createTextNode(e);return M(e)},fromDom:M,fromPoint:function(e,t,n){return T.from(e.dom.elementFromPoint(t,n)).map(M)}},C=function(e,t){e=e.dom;if(1!==e.nodeType)return!1;if(e.matches!==undefined)return e.matches(t);if(e.msMatchesSelector!==undefined)return e.msMatchesSelector(t);if(e.webkitMatchesSelector!==undefined)return e.webkitMatchesSelector(t);if(e.mozMatchesSelector!==undefined)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},O=("undefined"!=typeof window||Function("return this;")(),function(e,t,n){for(var r=e.dom,o=h(n)?n:y;r.parentNode;){var r=r.parentNode,i=S.fromDom(r);if(t(i))return T.some(i);if(o(i))break}return T.none()}),q=function(e,t,n){return O(e,function(e){return C(e,t)},n)},x=(N=d,function(e,t,n){return function(e,t){if(t(e))return;throw new Error("Default value doesn't match requested type.")}(n,N),function(e,t){if(s(e)||f(e))throw new Error("expected a string but found: "+e);return g(e)?t:m(e)?!1===e?"":t:e}(e.getParam(t,n),n)}),A=function(o){var e=x(o,"quickbars_insert_toolbar","quickimage quicktable");0<e.trim().length&&o.ui.registry.addContextToolbar("quickblock",{predicate:function(e){var t=S.fromDom(e),n=o.schema.getTextBlockElements(),r=function(e){return e.dom===o.getBody()};return E(C,q,t,"table",r).fold(function(){return E(function(e,t){return t(e)},O,t,function(e){return e.dom.nodeName.toLowerCase()in n&&o.dom.isEmpty(e.dom)},r).isSome()},y)},items:e,position:"line",scope:"editor"})},D=function(t){var n=function(e){return"IMG"===e.nodeName||"FIGURE"===e.nodeName&&/image/i.test(e.className)},e=x(t,"quickbars_image_toolbar","alignleft aligncenter alignright");0<e.trim().length&&t.ui.registry.addContextToolbar("imageselection",{predicate:n,items:e,position:"node"});e=x(t,"quickbars_selection_toolbar","bold italic | quicklink h2 h3 blockquote");0<e.trim().length&&t.ui.registry.addContextToolbar("textselection",{predicate:function(e){return!n(e)&&!t.selection.isCollapsed()&&"false"!==t.dom.getContentEditableParent(e)},items:e,position:"selection",scope:"editor"})};e.add("quickbars",function(e){n(e),A(e),D(e)})}();