/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.9.0 (TBD)
 */
!function(){"use strict";var t,u,n=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function i(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},m=function(t){var n=t;return{get:function(){return n},set:function(t){n=t}}},a=function(t){return function(){return t}},e=function(t){return t},c=a(!1),l=a(!0),o=function(){return s},s={fold:function(t,n){return t()},isSome:c,isNone:l,getOr:e,getOrThunk:t=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(undefined),or:e,orThunk:t,map:o,each:function(){},bind:o,exists:c,forall:l,filter:function(){return s},toArray:function(){return[]},toString:a("none()")},f=function(e){var t=a(e),n=function(){return r},o=function(t){return t(e)},r={fold:function(t,n){return n(e)},isSome:l,isNone:c,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return f(t(e))},each:function(t){t(e)},bind:o,exists:o,forall:o,filter:function(t){return t(e)?r:s},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return r},g={some:f,none:o,from:function(t){return null===t||t===undefined?s:f(t)}},d=Object.keys,r=Object.hasOwnProperty,h=function(t,n){for(var e=d(t),o=0,r=e.length;o<r;o++){var i=e[o];n(t[i],i)}},y=function(t,e){var o={};return h(t,function(t,n){n=e(t,n);o[n.k]=n.v}),o},v=function(t,n){return r.call(t,n)},p=(u=function(t,n){return n},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<t.length;o++){var r,i=t[o];for(r in i)v(i,r)&&(e[r]=u(e[r],i[r]))}return e}),b=function(t,n){return-1!==t.indexOf(n)},w=tinymce.util.Tools.resolve("tinymce.Resource"),O=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.Promise"),k="All",j={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},A=function(t){var e,t=t.getParam("emoticons_append",{},"object");return e=function(t){return i({keywords:[],category:"user"},t)},y(t,function(t,n){return{k:n,v:e(t,n)}})},T=function(e,r,t){var o=m(g.none()),n=m(g.none()),a=e.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string"),i=function(t){var i={},u=[];h(t,function(t,n){var e,o,r,e={title:n,keywords:t.keywords,"char":(o=(e=t)["char"],r=o,o=0,""===(n=n="<img")||r.length>=n.length&&r.substr(o,o+n.length)===n?e["char"].replace(/src="([^"]+)"/,function(t,n){return'src="'+a+n+'"'}):e["char"]),category:(e=j,t=t.category,v(e,t)?e[t]:t)},t=i[e.category]!==undefined?i[e.category]:[];i[e.category]=t.concat([e]),u.push(e)}),o.set(g.some(i)),n.set(g.some(u))};e.on("init",function(){w.load(t,r).then(function(t){var n=A(e);i(p(t,n))},function(t){console.log("Failed to load emoticons: "+t),o.set(g.some({})),n.set(g.some([]))})});var u=function(){return n.get().getOr([])},c=function(){return o.get().isSome()&&n.get().isSome()};return{listCategories:function(){return[k].concat(d(o.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?C.resolve(!0):new C(function(t,n){var e=15,o=O.setInterval(function(){c()?(O.clearInterval(o),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+r),O.clearInterval(o),n(!1))},100)})},listAll:u,listCategory:function(n){return n===k?u():o.get().bind(function(t){return g.from(t[n])}).getOr([])}}},_=function(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){!function(t,n){for(var e=0,o=t.length;e<o;e++)n(t[e],e)}(t,function(t){t.attr("data-mce-resize","false"),t.attr("data-mce-placeholder","1")})})})},P=function(t,n,e){for(var o=[],r=n.toLowerCase(),i=e.fold(function(){return c},function(n){return function(t){return n<=t}}),u=0;u<t.length&&(0!==n.length&&!function(t,n){return b(t.title.toLowerCase(),n)||function(t,n){for(var e=0,o=t.length;e<o;e++)if(n(t[e],e))return!0;return!1}(t.keywords,function(t){return b(t.toLowerCase(),n)})}(t[u],r)||(o.push({value:t[u]["char"],text:t[u].title,icon:t[u]["char"]}),!i(o.length)));u++);return o},x="pattern",D=function(e,r){var o,i,u,t={pattern:"",results:P(r.listAll(),"",g.some(300))},a=m(k),c=(o=function(t){var n,e,o;e=(n=t).getData(),o=a.get(),t=r.listCategory(o),o=P(t,e[x],o===k?g.some(300):g.none()),n.setData({results:o})},i=200,u=null,{cancel:function(){null!==u&&(clearTimeout(u),u=null)},throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];null!==u&&clearTimeout(u),u=setTimeout(function(){o.apply(null,t),u=null},i)}}),n={label:"Search",type:"input",name:x},l={type:"collection",name:"results"},s=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t,n){for(var e=t.length,o=new Array(e),r=0;r<e;r++){var i=t[r];o[r]=n(i,r)}return o}(r.listCategories(),function(t){return{title:t,name:t,items:[n,l]}})},initialData:t,onTabChange:function(t,n){a.set(n.newTabName),c.throttle(t)},onChange:c.throttle,onAction:function(t,n){"results"===n.name&&(n=n.value,e.insertContent(n),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},f=e.windowManager.open(s());f.focus(x),r.hasLoaded()||(f.block("Loading emoticons..."),r.waitForLoad().then(function(){f.redial(s()),c.throttle(f),f.focus(x),f.unblock()})["catch"](function(t){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(x),f.unblock()}))};n.add("emoticons",function(t,n){var e,o,r,i,u,n=(e=n,n=(a=t).getParam("emoticons_database","emojis","string"),a.getParam("emoticons_database_url",e+"/js/"+n+a.suffix+".js","string")),a=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),n=T(t,n,a);r=n,a=function(){return D(o,r)},(o=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:a}),o.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:a}),u=n,(i=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return u.waitForLoad().then(function(){var t=u.listAll();return P(t,n,g.some(e))})},onAction:function(t,n,e){i.selection.setRng(n),i.insertContent(e),t.hide()}}),_(t)})}();